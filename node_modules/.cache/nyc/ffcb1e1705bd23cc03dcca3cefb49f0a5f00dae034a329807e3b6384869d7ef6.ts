"use strict";var cov_1now6xbm93=function(){var path="/Users/fastpagamentos/development/Testes/graphql-2/src/graphql/resources/comment/comment.resolvers.ts";var hash="e8b54d6432ceb24d198fa6b9432ca3525c064770";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/fastpagamentos/development/Testes/graphql-2/src/graphql/resources/comment/comment.resolvers.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:16},end:{line:3,column:49}},"2":{start:{line:4,column:30},end:{line:4,column:77}},"3":{start:{line:5,column:24},end:{line:5,column:65}},"4":{start:{line:6,column:0},end:{line:71,column:2}},"5":{start:{line:9,column:12},end:{line:11,column:44}},"6":{start:{line:14,column:12},end:{line:16,column:44}},"7":{start:{line:21,column:12},end:{line:21,column:38}},"8":{start:{line:22,column:12},end:{line:31,column:44}},"9":{start:{line:36,column:12},end:{line:36,column:37}},"10":{start:{line:37,column:12},end:{line:41,column:44}},"11":{start:{line:38,column:16},end:{line:39,column:55}},"12":{start:{line:44,column:12},end:{line:44,column:30}},"13":{start:{line:45,column:12},end:{line:55,column:44}},"14":{start:{line:46,column:16},end:{line:53,column:19}},"15":{start:{line:49,column:20},end:{line:49,column:84}},"16":{start:{line:50,column:20},end:{line:50,column:132}},"17":{start:{line:51,column:20},end:{line:51,column:45}},"18":{start:{line:52,column:20},end:{line:52,column:69}},"19":{start:{line:58,column:12},end:{line:58,column:30}},"20":{start:{line:59,column:12},end:{line:68,column:44}},"21":{start:{line:60,column:16},end:{line:66,column:19}},"22":{start:{line:63,column:20},end:{line:63,column:84}},"23":{start:{line:64,column:20},end:{line:64,column:134}},"24":{start:{line:65,column:20},end:{line:65,column:63}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:14},end:{line:8,column:15}},loc:{start:{line:8,column:72},end:{line:12,column:9}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:14},end:{line:13,column:15}},loc:{start:{line:13,column:76},end:{line:17,column:9}},line:13},"2":{name:"(anonymous_2)",decl:{start:{line:20,column:24},end:{line:20,column:25}},loc:{start:{line:20,column:88},end:{line:32,column:9}},line:20},"3":{name:"(anonymous_3)",decl:{start:{line:35,column:87},end:{line:35,column:88}},loc:{start:{line:35,column:129},end:{line:42,column:9}},line:35},"4":{name:"(anonymous_4)",decl:{start:{line:37,column:44},end:{line:37,column:45}},loc:{start:{line:37,column:51},end:{line:40,column:13}},line:37},"5":{name:"(anonymous_5)",decl:{start:{line:43,column:87},end:{line:43,column:88}},loc:{start:{line:43,column:133},end:{line:56,column:9}},line:43},"6":{name:"(anonymous_6)",decl:{start:{line:45,column:44},end:{line:45,column:45}},loc:{start:{line:45,column:51},end:{line:54,column:13}},line:45},"7":{name:"(anonymous_7)",decl:{start:{line:48,column:26},end:{line:48,column:27}},loc:{start:{line:48,column:39},end:{line:53,column:17}},line:48},"8":{name:"(anonymous_8)",decl:{start:{line:57,column:87},end:{line:57,column:88}},loc:{start:{line:57,column:126},end:{line:69,column:9}},line:57},"9":{name:"(anonymous_9)",decl:{start:{line:59,column:44},end:{line:59,column:45}},loc:{start:{line:59,column:51},end:{line:67,column:13}},line:59},"10":{name:"(anonymous_10)",decl:{start:{line:62,column:26},end:{line:62,column:27}},loc:{start:{line:62,column:39},end:{line:66,column:17}},line:62}},branchMap:{"0":{loc:{start:{line:20,column:44},end:{line:20,column:54}},type:"default-arg",locations:[{start:{line:20,column:52},end:{line:20,column:54}}],line:20},"1":{loc:{start:{line:20,column:56},end:{line:20,column:66}},type:"default-arg",locations:[{start:{line:20,column:65},end:{line:20,column:66}}],line:20}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0],"1":[0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"e8b54d6432ceb24d198fa6b9432ca3525c064770"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();cov_1now6xbm93.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const utils_1=(cov_1now6xbm93.s[1]++,require("../../../helpers/utils"));const composable_resolver_1=(cov_1now6xbm93.s[2]++,require("../../composable/composable.resolver"));const auth_resolver_1=(cov_1now6xbm93.s[3]++,require("../../composable/auth.resolver"));cov_1now6xbm93.s[4]++;exports.commentResolvers={Comment:{user:(comment,args,{dataloaders:{userLoader}},info)=>{cov_1now6xbm93.f[0]++;cov_1now6xbm93.s[5]++;return userLoader.load({key:comment.get('user'),info}).catch(utils_1.handleError);},post:(comment,args,{db,dataloaders:{postLoader}},info)=>{cov_1now6xbm93.f[1]++;cov_1now6xbm93.s[6]++;return postLoader.load({key:comment.get('post'),info}).catch(utils_1.handleError);}},Query:{commentsByPost:(comment,{postId,limit=(cov_1now6xbm93.b[0][0]++,10),offset=(cov_1now6xbm93.b[1][0]++,0)},context,info)=>{cov_1now6xbm93.f[2]++;cov_1now6xbm93.s[7]++;postId=parseInt(postId);cov_1now6xbm93.s[8]++;return context.db.Comment.findAll({where:{post:postId},limit:limit,offset:offset,attributes:context.requestedFields.getFields(info)}).catch(utils_1.handleError);}},Mutation:{createComment:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((comment,{input},{db,authUser})=>{cov_1now6xbm93.f[3]++;cov_1now6xbm93.s[9]++;input.user=authUser.id;cov_1now6xbm93.s[10]++;return db.sequelize.transaction(t=>{cov_1now6xbm93.f[4]++;cov_1now6xbm93.s[11]++;return db.Comment.create(input,{transaction:t});}).catch(utils_1.handleError);}),updateComment:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((comment,{id,input},{db,authUser})=>{cov_1now6xbm93.f[5]++;cov_1now6xbm93.s[12]++;id=parseInt(id);cov_1now6xbm93.s[13]++;return db.sequelize.transaction(t=>{cov_1now6xbm93.f[6]++;cov_1now6xbm93.s[14]++;return db.Comment.findById(id).then(comment=>{cov_1now6xbm93.f[7]++;cov_1now6xbm93.s[15]++;utils_1.throwError(!comment,`Comment with id ${id} not found`);cov_1now6xbm93.s[16]++;utils_1.throwError(comment.get('user')!==authUser.id,`Unauthorized! You can only edit comment by yourself.`);cov_1now6xbm93.s[17]++;input.user=authUser.id;cov_1now6xbm93.s[18]++;return comment.update(input,{transaction:t});});}).catch(utils_1.handleError);}),deleteComment:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((comment,{id},{db,authUser})=>{cov_1now6xbm93.f[8]++;cov_1now6xbm93.s[19]++;id=parseInt(id);cov_1now6xbm93.s[20]++;return db.sequelize.transaction(t=>{cov_1now6xbm93.f[9]++;cov_1now6xbm93.s[21]++;return db.Comment.findById(id).then(comment=>{cov_1now6xbm93.f[10]++;cov_1now6xbm93.s[22]++;utils_1.throwError(!comment,`Comment with id ${id} not found`);cov_1now6xbm93.s[23]++;utils_1.throwError(comment.get('user')!==authUser.id,`Unauthorized! You can only delete comment by yourself.`);cov_1now6xbm93.s[24]++;return comment.destroy({transaction:t});});}).catch(utils_1.handleError);})}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2Zhc3RwYWdhbWVudG9zL2RldmVsb3BtZW50L1Rlc3Rlcy9ncmFwaHFsLTIvc3JjL2dyYXBocWwvcmVzb3VyY2VzL2NvbW1lbnQvY29tbWVudC5yZXNvbHZlcnMudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9mYXN0cGFnYW1lbnRvcy9kZXZlbG9wbWVudC9UZXN0ZXMvZ3JhcGhxbC0yL3NyYy9ncmFwaHFsL3Jlc291cmNlcy9jb21tZW50L2NvbW1lbnQucmVzb2x2ZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsa0RBQWlFO0FBQ2pFLDhFQUErRDtBQUMvRCxrRUFBK0Q7QUFLbEQsUUFBQSxnQkFBZ0IsR0FBRztJQUU1QixPQUFPLEVBQUU7UUFDTCxJQUFJLEVBQUUsQ0FBQyxPQUF3QixFQUFFLElBQUksRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFrRCxFQUFFLElBQXdCLEVBQUUsRUFBRTtZQUNoSixPQUFPLFVBQVU7aUJBQ1osSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUM7aUJBQ3hDLEtBQUssQ0FBQyxtQkFBVyxDQUFDLENBQUE7UUFDM0IsQ0FBQztRQUVELElBQUksRUFBRSxDQUFDLE9BQXdCLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFrRCxFQUFFLElBQXdCLEVBQUUsRUFBRTtZQUNwSixPQUFPLFVBQVU7aUJBQ1osSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFDLENBQUM7aUJBQ3ZDLEtBQUssQ0FBQyxtQkFBVyxDQUFDLENBQUE7UUFDM0IsQ0FBQztLQUNKO0lBRUQsS0FBSyxFQUFFO1FBQ0gsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUss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Q0FBQTtvQkFDdkQsa0JBQVUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLFFBQVEsQ0FBQyxFQUFFLEVBQUUsd0RBQXdELENBQUMsQ0FBQTtvQkFFekcsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7Z0JBQzlDLENBQUMsQ0FBQyxDQUFBO1lBQ1YsQ0FBQyxDQUFDO2lCQUNHLEtBQUssQ0FBQyxtQkFBVyxDQUFDLENBQUE7UUFDM0IsQ0FBQyxDQUFDO0tBQ0w7Q0FFSixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXV0aFVzZXIgfSBmcm9tICcuLy4uLy4uLy4uL2ludGVyZmFjZXMvQXV0aFVzZXJJbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ29tbWVudEluc3RhbmNlIH0gZnJvbSAnLi8uLi8uLi8uLi9tb2RlbHMvQ29tbWVudE1vZGVsJztcbmltcG9ydCB7IERiQ29ubmVjdGlvbiB9IGZyb20gJy4vLi4vLi4vLi4vaW50ZXJmYWNlcy9EYkNvbm5lY3Rpb25JbnRlcmZhY2UnO1xuaW1wb3J0IHsgVHJhbnNhY3Rpb24gfSBmcm9tICdzZXF1ZWxpemUnO1xuaW1wb3J0IHsgaGFuZGxlRXJyb3IsIHRocm93RXJyb3IgfSBmcm9tICcuLi8uLi8uLi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCB7IGNvbXBvc2UgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlL2NvbXBvc2FibGUucmVzb2x2ZXInO1xuaW1wb3J0IHsgYXV0aFJlc29sdmVycyB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvYXV0aC5yZXNvbHZlcic7XG5pbXBvcnQgeyBEYXRhTG9hZGVycyB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvRGF0YUxvYWRlcnNJbnRlcmZhY2UnO1xuaW1wb3J0IHsgUmVzb2x2ZXJDb250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9SZXNvbHZlckNvbnRleHRJbnRlcmZhY2UnO1xuaW1wb3J0IHsgR3JhcGhRTFJlc29sdmVJbmZvIH0gZnJvbSAnZ3JhcGhxbCc7XG5cbmV4cG9ydCBjb25zdCBjb21tZW50UmVzb2x2ZXJzID0ge1xuXG4gICAgQ29tbWVudDoge1xuICAgICAgICB1c2VyOiAoY29tbWVudDogQ29tbWVudEluc3RhbmNlLCBhcmdzLCB7IGRhdGFsb2FkZXJzOiB7IHVzZXJMb2FkZXIgfSB9OiB7IGRiOiBEYkNvbm5lY3Rpb24sIGRhdGFsb2FkZXJzOiBEYXRhTG9hZGVycyB9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB1c2VyTG9hZGVyXG4gICAgICAgICAgICAgICAgLmxvYWQoeyBrZXk6IGNvbW1lbnQuZ2V0KCd1c2VyJyksIGluZm8gfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goaGFuZGxlRXJyb3IpXG4gICAgICAgIH0sXG5cbiAgICAgICAgcG9zdDogKGNvbW1lbnQ6IENvbW1lbnRJbnN0YW5jZSwgYXJncywgeyBkYiwgZGF0YWxvYWRlcnM6IHsgcG9zdExvYWRlciB9IH06IHsgZGI6IERiQ29ubmVjdGlvbiwgZGF0YWxvYWRlcnM6IERhdGFMb2FkZXJzIH0sIGluZm86IEdyYXBoUUxSZXNvbHZlSW5mbykgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2FkZXJcbiAgICAgICAgICAgICAgICAubG9hZCh7IGtleTogY29tbWVudC5nZXQoJ3Bvc3QnKSwgaW5mb30pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBRdWVyeToge1xuICAgICAgICBjb21tZW50c0J5UG9zdDogKGNvbW1lbnQsIHsgcG9zdElkLCBsaW1pdCA9IDEwLCBvZmZzZXQgPSAwIH0sIGNvbnRleHQ6IFJlc29sdmVyQ29udGV4dCwgaW5mbzogR3JhcGhRTFJlc29sdmVJbmZvKSA9PiB7XG4gICAgICAgICAgICBwb3N0SWQgPSBwYXJzZUludChwb3N0SWQpXG4gICAgICAgICAgICByZXR1cm4gY29udGV4dC5kYi5Db21tZW50XG4gICAgICAgICAgICAgICAgLmZpbmRBbGwoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zdDogcG9zdElkXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxpbWl0OiBsaW1pdCxcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGNvbnRleHQucmVxdWVzdGVkRmllbGRzLmdldEZpZWxkcyhpbmZvKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBNdXRhdGlvbjoge1xuICAgICAgICBjcmVhdGVDb21tZW50OiBjb21wb3NlKC4uLmF1dGhSZXNvbHZlcnMpKChjb21tZW50OiBDb21tZW50SW5zdGFuY2UsIHsgaW5wdXQgfSwgeyBkYiwgYXV0aFVzZXIgfTogeyBkYjogRGJDb25uZWN0aW9uLCBhdXRoVXNlcjogQXV0aFVzZXIgfSkgPT4ge1xuICAgICAgICAgICAgaW5wdXQudXNlciA9IGF1dGhVc2VyLmlkXG4gICAgICAgICAgICByZXR1cm4gZGIuc2VxdWVsaXplLnRyYW5zYWN0aW9uKCh0OiBUcmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYi5Db21tZW50XG4gICAgICAgICAgICAgICAgICAgIC5jcmVhdGUoaW5wdXQsIHsgdHJhbnNhY3Rpb246IHQgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgICAgICB9KSxcblxuICAgICAgICB1cGRhdGVDb21tZW50OiBjb21wb3NlKC4uLmF1dGhSZXNvbHZlcnMpKChjb21tZW50OiBDb21tZW50SW5zdGFuY2UsIHsgaWQsIGlucHV0IH0sIHsgZGIsIGF1dGhVc2VyIH06IHsgZGI6IERiQ29ubmVjdGlvbiwgYXV0aFVzZXI6IEF1dGhVc2VyIH0pID0+IHtcbiAgICAgICAgICAgIGlkID0gcGFyc2VJbnQoaWQpXG4gICAgICAgICAgICByZXR1cm4gZGIuc2VxdWVsaXplLnRyYW5zYWN0aW9uKCh0OiBUcmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYi5Db21tZW50XG4gICAgICAgICAgICAgICAgICAgIC5maW5kQnlJZChpZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGNvbW1lbnQ6IENvbW1lbnRJbnN0YW5jZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dFcnJvcighY29tbWVudCwgYENvbW1lbnQgd2l0aCBpZCAke2lkfSBub3QgZm91bmRgKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dFcnJvcihjb21tZW50LmdldCgndXNlcicpICE9PSBhdXRoVXNlci5pZCwgYFVuYXV0aG9yaXplZCEgWW91IGNhbiBvbmx5IGVkaXQgY29tbWVudCBieSB5b3Vyc2VsZi5gKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC51c2VyID0gYXV0aFVzZXIuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21tZW50LnVwZGF0ZShpbnB1dCwgeyB0cmFuc2FjdGlvbjogdCB9KVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goaGFuZGxlRXJyb3IpXG4gICAgICAgIH0pLFxuXG4gICAgICAgIGRlbGV0ZUNvbW1lbnQ6IGNvbXBvc2UoLi4uYXV0aFJlc29sdmVycykoKGNvbW1lbnQ6IENvbW1lbnRJbnN0YW5jZSwgeyBpZCB9LCB7IGRiLCBhdXRoVXNlciB9OiB7IGRiOiBEYkNvbm5lY3Rpb24sIGF1dGhVc2VyOiBBdXRoVXNlciB9KSA9PiB7XG4gICAgICAgICAgICBpZCA9IHBhcnNlSW50KGlkKVxuICAgICAgICAgICAgcmV0dXJuIGRiLnNlcXVlbGl6ZS50cmFuc2FjdGlvbigodDogVHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGIuQ29tbWVudFxuICAgICAgICAgICAgICAgICAgICAuZmluZEJ5SWQoaWQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKChjb21tZW50OiBDb21tZW50SW5zdGFuY2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoIWNvbW1lbnQsIGBDb21tZW50IHdpdGggaWQgJHtpZH0gbm90IGZvdW5kYClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93RXJyb3IoY29tbWVudC5nZXQoJ3VzZXInKSAhPT0gYXV0aFVzZXIuaWQsIGBVbmF1dGhvcml6ZWQhIFlvdSBjYW4gb25seSBkZWxldGUgY29tbWVudCBieSB5b3Vyc2VsZi5gKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tbWVudC5kZXN0cm95KHsgdHJhbnNhY3Rpb246IHQgfSlcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgICAgICB9KVxuICAgIH1cblxufSJdfQ==