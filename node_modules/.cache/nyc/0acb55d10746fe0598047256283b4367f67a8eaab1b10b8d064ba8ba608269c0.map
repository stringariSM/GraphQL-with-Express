{"version":3,"file":"/Users/fastpagamentos/development/Testes/graphql-2/src/graphql/token/token.resolvers.ts","sources":["/Users/fastpagamentos/development/Testes/graphql-2/src/graphql/token/token.resolvers.ts"],"names":[],"mappings":";;AAAA,+CAAiD;AAGjD,oCAAmC;AAGtB,QAAA,cAAc,GAAG;IAE1B,QAAQ,EAAE;QACN,WAAW,EAAE,CAAC,KAAK,EAAE,EAAE,KAAK,EAAE,QAAQ,EAAE,EAAE,EAAE,EAAE,EAAwB,EAAE,EAAE;YACtE,OAAO,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC;gBACnB,KAAK,EAAE;oBACH,KAAK,EAAE,KAAK;iBACf;gBACD,UAAU,EAAE,CAAC,IAAI,EAAE,UAAU,CAAC;aACjC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAkB,EAAE,EAAE;gBAC3B,IAAI,YAAY,GAAW,4CAA4C,CAAA;gBACvE,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,QAAQ,CAAC;oBACzD,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAA;gBAEjC,MAAM,OAAO,GAAG;oBACZ,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;iBACtB,CAAA;gBAED,OAAO;oBACH,KAAK,EAAE,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,kBAAU,EAAE;wBACjC,SAAS,EAAE,OAAO;qBAErB,CAAC;iBACL,CAAA;YACL,CAAC,CAAC,CAAA;QACN,CAAC;KACJ;CAEJ,CAAA","sourcesContent":["import { JWT_SECRET } from '../../helpers/utils';\nimport { UserInstance } from './../../models/UserModel';\nimport { DbConnection } from \"../../interfaces/DbConnectionInterface\";\nimport * as jwt from 'jsonwebtoken'\n\n\nexport const tokenResolvers = {\n\n    Mutation: {\n        createToken: (token, { email, password }, { db }: { db: DbConnection }) => {\n            return db.User.findOne({\n                where: {\n                    email: email\n                },\n                attributes: ['id', 'password']\n            }).then((user: UserInstance) => {\n                let errorMessage: string = 'NÃ£o autorizado! E-mail ou senha incorretos'\n                if (!user || !user.isPassword(user.get('password'), password))\n                    throw new Error(errorMessage)\n\n                const payload = {\n                    sub: user.get('id')\n                }\n\n                return {\n                    token: jwt.sign(payload, JWT_SECRET, {\n                        algorithm: 'RS256',\n                        // expiresIn: \"7d\"\n                    })\n                }\n            })\n        },\n    }\n\n}"]}