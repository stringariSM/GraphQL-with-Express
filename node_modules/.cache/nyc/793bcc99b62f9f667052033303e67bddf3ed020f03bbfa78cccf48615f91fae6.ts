"use strict";var cov_115sj65l1n=function(){var path="/Users/fastpagamentos/development/Testes/graphql-2/src/graphql/resources/post/post.resolvers.ts";var hash="6642c2f7d6363c9ad5ea34f378dfc05ca3763708";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/fastpagamentos/development/Testes/graphql-2/src/graphql/resources/post/post.resolvers.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:22},end:{line:3,column:47}},"2":{start:{line:4,column:16},end:{line:4,column:49}},"3":{start:{line:5,column:30},end:{line:5,column:77}},"4":{start:{line:6,column:24},end:{line:6,column:65}},"5":{start:{line:7,column:0},end:{line:91,column:2}},"6":{start:{line:10,column:12},end:{line:15,column:44}},"7":{start:{line:18,column:12},end:{line:26,column:44}},"8":{start:{line:31,column:29},end:{line:31,column:61}},"9":{start:{line:32,column:12},end:{line:38,column:44}},"10":{start:{line:41,column:12},end:{line:41,column:30}},"11":{start:{line:42,column:12},end:{line:51,column:44}},"12":{start:{line:47,column:16},end:{line:48,column:68}},"13":{start:{line:48,column:20},end:{line:48,column:68}},"14":{start:{line:49,column:16},end:{line:49,column:28}},"15":{start:{line:56,column:12},end:{line:56,column:39}},"16":{start:{line:57,column:12},end:{line:61,column:44}},"17":{start:{line:58,column:16},end:{line:59,column:55}},"18":{start:{line:64,column:12},end:{line:64,column:30}},"19":{start:{line:65,column:12},end:{line:75,column:44}},"20":{start:{line:66,column:16},end:{line:73,column:19}},"21":{start:{line:69,column:20},end:{line:69,column:78}},"22":{start:{line:70,column:20},end:{line:70,column:129}},"23":{start:{line:71,column:20},end:{line:71,column:47}},"24":{start:{line:72,column:20},end:{line:72,column:66}},"25":{start:{line:78,column:12},end:{line:78,column:30}},"26":{start:{line:79,column:12},end:{line:88,column:44}},"27":{start:{line:80,column:16},end:{line:86,column:19}},"28":{start:{line:83,column:20},end:{line:83,column:78}},"29":{start:{line:84,column:20},end:{line:84,column:131}},"30":{start:{line:85,column:20},end:{line:85,column:60}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:16},end:{line:9,column:17}},loc:{start:{line:9,column:71},end:{line:16,column:9}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:17,column:18},end:{line:17,column:19}},loc:{start:{line:17,column:64},end:{line:27,column:9}},line:17},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:15},end:{line:30,column:16}},loc:{start:{line:30,column:68},end:{line:39,column:9}},line:30},"3":{name:"(anonymous_3)",decl:{start:{line:40,column:14},end:{line:40,column:15}},loc:{start:{line:40,column:47},end:{line:52,column:9}},line:40},"4":{name:"(anonymous_4)",decl:{start:{line:46,column:22},end:{line:46,column:23}},loc:{start:{line:46,column:32},end:{line:50,column:13}},line:46},"5":{name:"(anonymous_5)",decl:{start:{line:55,column:84},end:{line:55,column:85}},loc:{start:{line:55,column:123},end:{line:62,column:9}},line:55},"6":{name:"(anonymous_6)",decl:{start:{line:57,column:44},end:{line:57,column:45}},loc:{start:{line:57,column:51},end:{line:60,column:13}},line:57},"7":{name:"(anonymous_7)",decl:{start:{line:63,column:84},end:{line:63,column:85}},loc:{start:{line:63,column:127},end:{line:76,column:9}},line:63},"8":{name:"(anonymous_8)",decl:{start:{line:65,column:44},end:{line:65,column:45}},loc:{start:{line:65,column:51},end:{line:74,column:13}},line:65},"9":{name:"(anonymous_9)",decl:{start:{line:68,column:26},end:{line:68,column:27}},loc:{start:{line:68,column:36},end:{line:73,column:17}},line:68},"10":{name:"(anonymous_10)",decl:{start:{line:77,column:84},end:{line:77,column:85}},loc:{start:{line:77,column:120},end:{line:89,column:9}},line:77},"11":{name:"(anonymous_11)",decl:{start:{line:79,column:44},end:{line:79,column:45}},loc:{start:{line:79,column:51},end:{line:87,column:13}},line:79},"12":{name:"(anonymous_12)",decl:{start:{line:82,column:26},end:{line:82,column:27}},loc:{start:{line:82,column:36},end:{line:86,column:17}},line:82}},branchMap:{"0":{loc:{start:{line:17,column:27},end:{line:17,column:37}},type:"default-arg",locations:[{start:{line:17,column:35},end:{line:17,column:37}}],line:17},"1":{loc:{start:{line:17,column:39},end:{line:17,column:49}},type:"default-arg",locations:[{start:{line:17,column:48},end:{line:17,column:49}}],line:17},"2":{loc:{start:{line:30,column:24},end:{line:30,column:34}},type:"default-arg",locations:[{start:{line:30,column:32},end:{line:30,column:34}}],line:30},"3":{loc:{start:{line:30,column:36},end:{line:30,column:46}},type:"default-arg",locations:[{start:{line:30,column:45},end:{line:30,column:46}}],line:30},"4":{loc:{start:{line:47,column:16},end:{line:48,column:68}},type:"if",locations:[{start:{line:47,column:16},end:{line:48,column:68}},{start:{line:47,column:16},end:{line:48,column:68}}],line:47}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},b:{"0":[0],"1":[0],"2":[0],"3":[0],"4":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"6642c2f7d6363c9ad5ea34f378dfc05ca3763708"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();cov_115sj65l1n.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const graphqlFields=(cov_115sj65l1n.s[1]++,require("graphql-fields"));const utils_1=(cov_115sj65l1n.s[2]++,require("../../../helpers/utils"));const composable_resolver_1=(cov_115sj65l1n.s[3]++,require("../../composable/composable.resolver"));const auth_resolver_1=(cov_115sj65l1n.s[4]++,require("../../composable/auth.resolver"));cov_115sj65l1n.s[5]++;exports.postResolvers={Post:{author:(post,args,{dataloaders:{userLoader}},info)=>{cov_115sj65l1n.f[0]++;cov_115sj65l1n.s[6]++;return userLoader.load({key:post.get('author'),info}).catch(utils_1.handleError);},comments:(post,{limit=(cov_115sj65l1n.b[0][0]++,10),offset=(cov_115sj65l1n.b[1][0]++,0)},{db})=>{cov_115sj65l1n.f[1]++;cov_115sj65l1n.s[7]++;return db.Comment.findAll({where:{post:post.get('id')},limit:limit,offset:offset}).catch(utils_1.handleError);}},Query:{posts:(post,{limit=(cov_115sj65l1n.b[2][0]++,10),offset=(cov_115sj65l1n.b[3][0]++,0)},context,info)=>{cov_115sj65l1n.f[2]++;let attributes=(cov_115sj65l1n.s[8]++,Object.keys(graphqlFields(info)));cov_115sj65l1n.s[9]++;return context.db.Post.findAll({limit:limit,offset:offset,attributes:context.requestedFields.getFields(info,{keep:['id'],exclude:['comments']})}).catch(utils_1.handleError);},post:(post,{id},context,info)=>{cov_115sj65l1n.f[3]++;cov_115sj65l1n.s[10]++;id=parseInt(id);cov_115sj65l1n.s[11]++;return context.db.Post.findById(id,{attributes:context.requestedFields.getFields(info,{keep:['id'],exclude:['comments']})}).then(user=>{cov_115sj65l1n.f[4]++;cov_115sj65l1n.s[12]++;if(!user){cov_115sj65l1n.b[4][0]++;cov_115sj65l1n.s[13]++;throw new Error(`User with id ${id} not found`);}else{cov_115sj65l1n.b[4][1]++;}cov_115sj65l1n.s[14]++;return user;}).catch(utils_1.handleError);}},Mutation:{createPost:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((post,{input},{db,authUser})=>{cov_115sj65l1n.f[5]++;cov_115sj65l1n.s[15]++;input.author=authUser.id;cov_115sj65l1n.s[16]++;return db.sequelize.transaction(t=>{cov_115sj65l1n.f[6]++;cov_115sj65l1n.s[17]++;return db.Post.create(input,{transaction:t});}).catch(utils_1.handleError);}),updatePost:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((post,{id,input},{db,authUser})=>{cov_115sj65l1n.f[7]++;cov_115sj65l1n.s[18]++;id=parseInt(id);cov_115sj65l1n.s[19]++;return db.sequelize.transaction(t=>{cov_115sj65l1n.f[8]++;cov_115sj65l1n.s[20]++;return db.Post.findById(id).then(post=>{cov_115sj65l1n.f[9]++;cov_115sj65l1n.s[21]++;utils_1.throwError(!post,`Post with id ${id} not found`);cov_115sj65l1n.s[22]++;utils_1.throwError(post.get('author')!==authUser.id,`Unauthorized! You can only edit posts by yourself.`);cov_115sj65l1n.s[23]++;input.author=authUser.id;cov_115sj65l1n.s[24]++;return post.update(input,{transaction:t});});}).catch(utils_1.handleError);}),deletePost:composable_resolver_1.compose(...auth_resolver_1.authResolvers)((post,{id},{db,authUser})=>{cov_115sj65l1n.f[10]++;cov_115sj65l1n.s[25]++;id=parseInt(id);cov_115sj65l1n.s[26]++;return db.sequelize.transaction(t=>{cov_115sj65l1n.f[11]++;cov_115sj65l1n.s[27]++;return db.Post.findById(id).then(post=>{cov_115sj65l1n.f[12]++;cov_115sj65l1n.s[28]++;utils_1.throwError(!post,`Post with id ${id} not found`);cov_115sj65l1n.s[29]++;utils_1.throwError(post.get('author')!==authUser.id,`Unauthorized! You can only delete posts by yourself.`);cov_115sj65l1n.s[30]++;return post.destroy({transaction:t});});}).catch(utils_1.handleError);})}};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2Zhc3RwYWdhbWVudG9zL2RldmVsb3BtZW50L1Rlc3Rlcy9ncmFwaHFsLTIvc3JjL2dyYXBocWwvcmVzb3VyY2VzL3Bvc3QvcG9zdC5yZXNvbHZlcnMudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9mYXN0cGFnYW1lbnRvcy9kZXZlbG9wbWVudC9UZXN0ZXMvZ3JhcGhxbC0yL3NyYy9ncmFwaHFsL3Jlc291cmNlcy9wb3N0L3Bvc3QucmVzb2x2ZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0RBQStDO0FBTy9DLGtEQUFpRTtBQUVqRSw4RUFBK0Q7QUFDL0Qsa0VBQStEO0FBSWxELFFBQUEsYUFBYSxHQUFHO0lBRXpCLElBQUksRUFBRTtRQUNGLE1BQU0sRUFBRSxDQUFDLElBQWtCLEVBQUUsSUFBSSxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsVUFBVSxFQUFFLEVBQWtELEVBQUUsSUFBd0IsRUFBRSxFQUFFO1lBQzVJLE9BQU8sVUFBVTtpQkFDWixJQUFJLENBQUM7Z0JBQ0YsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDO2dCQUN2QixJQUFJO2FBQ1AsQ0FBQztpQkFDRCxLQUFLLENBQUMsbUJBQVcsQ0FBQyxDQUFBO1FBQzNCLENBQUM7UUFFRCxRQUFRLEVBQUUsQ0FBQyxJQUFrQixFQUFFLEVBQUUsS0FBSyxHQUFHLEVBQUUsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQXdCLEVBQUUsRUFBRTtZQUN2RixPQUFPLEVBQUUsQ0FBQyxPQUFPO2lCQUNaLE9BQU8sQ0FBQztnQkFDTCxLQUFLLEVBQUU7b0JBQ0gsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO2lCQUN2QjtnQkFDRCxLQUFLLEVBQUUsS0FBSztnQkFDWixNQUFNLEVBQUUsTUFBTTthQUNqQixDQUFDO2lCQUNELEtBQUssQ0FBQyxtQkFBVyxDQUFDLENBQUE7UUFDM0IsQ0FBQztLQUNK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ZW50IjpbImltcG9ydCAqIGFzIGdyYXBocWxGaWVsZHMgZnJvbSAnZ3JhcGhxbC1maWVsZHMnXG5cbmltcG9ydCB7IERhdGFMb2FkZXJzIH0gZnJvbSAnLi8uLi8uLi8uLi9pbnRlcmZhY2VzL0RhdGFMb2FkZXJzSW50ZXJmYWNlJztcbmltcG9ydCB7IEF1dGhVc2VyIH0gZnJvbSAnLi8uLi8uLi8uLi9pbnRlcmZhY2VzL0F1dGhVc2VySW50ZXJmYWNlJztcbmltcG9ydCB7IFBvc3RJbnN0YW5jZSB9IGZyb20gJy4vLi4vLi4vLi4vbW9kZWxzL1Bvc3RNb2RlbCc7XG5pbXBvcnQgeyBEYkNvbm5lY3Rpb24gfSBmcm9tICcuLy4uLy4uLy4uL2ludGVyZmFjZXMvRGJDb25uZWN0aW9uSW50ZXJmYWNlJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uIH0gZnJvbSAnc2VxdWVsaXplJztcbmltcG9ydCB7IGhhbmRsZUVycm9yLCB0aHJvd0Vycm9yIH0gZnJvbSAnLi4vLi4vLi4vaGVscGVycy91dGlscyc7XG5pbXBvcnQgeyBnZW5lcmljR2V0QWxsLCBnZW5lcmljR2V0QnlJZCB9IGZyb20gJy4uLy4uL2dlbmVyaWMnO1xuaW1wb3J0IHsgY29tcG9zZSB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGUvY29tcG9zYWJsZS5yZXNvbHZlcic7XG5pbXBvcnQgeyBhdXRoUmVzb2x2ZXJzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZS9hdXRoLnJlc29sdmVyJztcbmltcG9ydCB7IEdyYXBoUUxSZXNvbHZlSW5mbyB9IGZyb20gJ2dyYXBocWwnO1xuaW1wb3J0IHsgUmVzb2x2ZXJDb250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9SZXNvbHZlckNvbnRleHRJbnRlcmZhY2UnO1xuXG5leHBvcnQgY29uc3QgcG9zdFJlc29sdmVycyA9IHtcblxuICAgIFBvc3Q6IHtcbiAgICAgICAgYXV0aG9yOiAocG9zdDogUG9zdEluc3RhbmNlLCBhcmdzLCB7IGRhdGFsb2FkZXJzOiB7IHVzZXJMb2FkZXIgfSB9OiB7IGRiOiBEYkNvbm5lY3Rpb24sIGRhdGFsb2FkZXJzOiBEYXRhTG9hZGVycyB9LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB1c2VyTG9hZGVyXG4gICAgICAgICAgICAgICAgLmxvYWQoe1xuICAgICAgICAgICAgICAgICAgICBrZXk6IHBvc3QuZ2V0KCdhdXRob3InKSxcbiAgICAgICAgICAgICAgICAgICAgaW5mb1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgICAgICB9LFxuXG4gICAgICAgIGNvbW1lbnRzOiAocG9zdDogUG9zdEluc3RhbmNlLCB7IGxpbWl0ID0gMTAsIG9mZnNldCA9IDAgfSwgeyBkYiB9OiB7IGRiOiBEYkNvbm5lY3Rpb24gfSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGRiLkNvbW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZEFsbCh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0OiBwb3N0LmdldCgnaWQnKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBsaW1pdDogbGltaXQsXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goaGFuZGxlRXJyb3IpXG4gICAgICAgIH0sXG4gICAgfSxcblxuICAgIFF1ZXJ5OiB7XG4gICAgICAgIHBvc3RzOiAocG9zdDogUG9zdEluc3RhbmNlLCB7IGxpbWl0ID0gMTAsIG9mZnNldCA9IDAgfSwgY29udGV4dDogUmVzb2x2ZXJDb250ZXh0LCBpbmZvOiBHcmFwaFFMUmVzb2x2ZUluZm8pID0+IHtcbiAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVzID0gT2JqZWN0LmtleXMoZ3JhcGhxbEZpZWxkcyhpbmZvKSlcblxuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZGIuUG9zdFxuICAgICAgICAgICAgICAgIC5maW5kQWxsKHtcbiAgICAgICAgICAgICAgICAgICAgbGltaXQ6IGxpbWl0LFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IG9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogY29udGV4dC5yZXF1ZXN0ZWRGaWVsZHMuZ2V0RmllbGRzKGluZm8sIHtrZWVwOiBbJ2lkJ10sIGV4Y2x1ZGU6IFsnY29tbWVudHMnXX0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goaGFuZGxlRXJyb3IpXG4gICAgICAgIH0sXG5cbiAgICAgICAgcG9zdDogKHBvc3Q6IFBvc3RJbnN0YW5jZSwgeyBpZCB9LCBjb250ZXh0OiBSZXNvbHZlckNvbnRleHQsIGluZm86IEdyYXBoUUxSZXNvbHZlSW5mbykgPT4ge1xuICAgICAgICAgICAgaWQgPSBwYXJzZUludChpZClcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmRiLlBvc3RcbiAgICAgICAgICAgICAgICAuZmluZEJ5SWQoaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogY29udGV4dC5yZXF1ZXN0ZWRGaWVsZHMuZ2V0RmllbGRzKGluZm8sIHsga2VlcDogWydpZCddLCBleGNsdWRlOiBbJ2NvbW1lbnRzJ10gfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKCh1c2VyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgRXJyb3IoYFVzZXIgd2l0aCBpZCAke2lkfSBub3QgZm91bmRgKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChoYW5kbGVFcnJvcilcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBNdXRhdGlvbjoge1xuICAgICAgICBjcmVhdGVQb3N0OiBjb21wb3NlKC4uLmF1dGhSZXNvbHZlcnMpKChwb3N0OiBQb3N0SW5zdGFuY2UsIHsgaW5wdXQgfSwgeyBkYiwgYXV0aFVzZXIgfTogeyBkYjogRGJDb25uZWN0aW9uLCBhdXRoVXNlcjogQXV0aFVzZXIgfSkgPT4ge1xuICAgICAgICAgICAgaW5wdXQuYXV0aG9yID0gYXV0aFVzZXIuaWRcbiAgICAgICAgICAgIHJldHVybiBkYi5zZXF1ZWxpemUudHJhbnNhY3Rpb24oKHQ6IFRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRiLlBvc3RcbiAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZShpbnB1dCwgeyB0cmFuc2FjdGlvbjogdCB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goaGFuZGxlRXJyb3IpXG4gICAgICAgIH0pLFxuXG4gICAgICAgIHVwZGF0ZVBvc3Q6IGNvbXBvc2UoLi4uYXV0aFJlc29sdmVycykoKHBvc3Q6IFBvc3RJbnN0YW5jZSwgeyBpZCwgaW5wdXQgfSwgeyBkYiwgYXV0aFVzZXIgfTogeyBkYjogRGJDb25uZWN0aW9uLCBhdXRoVXNlcjogQXV0aFVzZXIgfSkgPT4ge1xuICAgICAgICAgICAgaWQgPSBwYXJzZUludChpZClcbiAgICAgICAgICAgIHJldHVybiBkYi5zZXF1ZWxpemUudHJhbnNhY3Rpb24oKHQ6IFRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRiLlBvc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbmRCeUlkKGlkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigocG9zdDogUG9zdEluc3RhbmNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCFwb3N0LCBgUG9zdCB3aXRoIGlkICR7aWR9IG5vdCBmb3VuZGApXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKHBvc3QuZ2V0KCdhdXRob3InKSAhPT0gYXV0aFVzZXIuaWQsIGBVbmF1dGhvcml6ZWQhIFlvdSBjYW4gb25seSBlZGl0IHBvc3RzIGJ5IHlvdXJzZWxmLmApXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmF1dGhvciA9IGF1dGhVc2VyLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9zdC51cGRhdGUoaW5wdXQsIHsgdHJhbnNhY3Rpb246IHQgfSlcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgICAgICB9KSxcblxuICAgICAgICBkZWxldGVQb3N0OiBjb21wb3NlKC4uLmF1dGhSZXNvbHZlcnMpKChwb3N0OiBQb3N0SW5zdGFuY2UsIHsgaWQgfSwgeyBkYiwgYXV0aFVzZXIgfTogeyBkYjogRGJDb25uZWN0aW9uLCBhdXRoVXNlcjogQXV0aFVzZXIgfSkgPT4ge1xuICAgICAgICAgICAgaWQgPSBwYXJzZUludChpZClcbiAgICAgICAgICAgIHJldHVybiBkYi5zZXF1ZWxpemUudHJhbnNhY3Rpb24oKHQ6IFRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRiLlBvc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbmRCeUlkKGlkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigocG9zdDogUG9zdEluc3RhbmNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCFwb3N0LCBgUG9zdCB3aXRoIGlkICR7aWR9IG5vdCBmb3VuZGApXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKHBvc3QuZ2V0KCdhdXRob3InKSAhPT0gYXV0aFVzZXIuaWQsIGBVbmF1dGhvcml6ZWQhIFlvdSBjYW4gb25seSBkZWxldGUgcG9zdHMgYnkgeW91cnNlbGYuYClcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvc3QuZGVzdHJveSh7IHRyYW5zYWN0aW9uOiB0IH0pXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChoYW5kbGVFcnJvcilcbiAgICAgICAgfSlcbiAgICB9XG5cbn0iXX0=